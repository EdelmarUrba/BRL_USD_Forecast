---
autoinstall:
  version: 1

  identity:
    hostname: ubuntu-dualboot
    username: urbauser
    password: >-
      $6$/vGaWlsjH6czk.sn$rblQNp1AY2bB655ekl7jKapVQzPPh63gZBhMNZ.87OkKYPOVf.4KuP0BPqUHtP1qcK4Dk4MQqxwbFJapkcDxY1

  locale: pt_BR.UTF-8
  keyboard:
    layout: br
    variant: nativo-us
  timezone: America/Sao_Paulo

  ssh:
    install-server: true
    allow-pw: false
    authorized-keys:
      - "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC..."

  apt:
    primary:
      - uri: http://archive.ubuntu.com/ubuntu
        suite: plucky
        components: [main, restricted, universe, multiverse]
    security:
      - uri: http://security.ubuntu.com/ubuntu
        suite: plucky-security
        components: [main, restricted, universe, multiverse]

  packages:
    - build-essential
    - python3
    - python3-pip
    - python3-venv
    - git
    - unzip
    - curl
    - wget
    - htop
    - ntfs-3g
    - software-properties-common

  storage:
    layout:
      name: custom
    devices:
      - match:
          serial: "SFYRDK2000G"
        ptable: gpt
        preserve: true
        grub_device: true
        wipe: superblock-recursive
        partitions:
          - size: 512M
            id: efi-part
            type: EF00
            fs:
              type: fat32
            label: EFI
            flag: boot,esp
            preserve: true

          - size: 150G
            id: ubuntu-root
            type: 8300
            flag: linux-root
            fs:
              type: ext4
            label: UbuntuRoot
            mount: /
            preserve: false

          - size: 150G
            id: ubuntu-home
            type: 8300
            fs:
              type: ext4
            label: Home
            mount: /home
            preserve: false

          - size: 32G
            id: swap-part
            type: 8200
            flag: swap
            preserve: false

          - size: 350G
            id: shared-ntfs
            type: 0700
            fs:
              type: ntfs
            label: Compartilhada
            mount: /mnt/compartilhada
            preserve: false

          - size: 900G
            id: win-space
            type: 0700
            preserve: true

          - size: 116G
            id: reserved-space
            type: 8300
            fs:
              type: ext4
            label: Reservada
            mount: /mnt/reservada
            preserve: true

  late-commands:
    - >-
      curtin in-target -- bash -c
      "echo '[INFO] Iniciando auto-instalação...' |
      tee /var/log/autoinstall.log"
    - >-
      curtin in-target -- bash -c
      "apt update && apt upgrade -y ||
      { echo 'Falha no apt upgrade' |
      tee -a /var/log/autoinstall.log; exit 1; }"
    - >-
      curtin in-target -- bash -c
      "snap install snapcraft --classic ||
      { echo 'Falha ao instalar Snapcraft' |
      tee -a /var/log/autoinstall.log; exit 1; }"
    - >-
      curtin in-target -- bash -c
      "chage -d 0 urbauser"
    - >-
      curtin in-target -- bash -c
      "echo '[INFO] Instalação finalizada com sucesso.' |
      tee -a /var/log/autoinstall.log"

  interactive-sections: []
